<?php
    $modulo = 'biblioteca';
    $usuario = $this->usuario;
    $nombreUsuario =  $usuario['apaterno']. ' '. $usuario['amaterno'].', '.$usuario['nombres'];
    $recursos = $this->recursos;
?>
<div class="row">
	<div class="col-md-12">
		<div class="panel panel-success">
			<div class="panel-heading">
				<h5 class="panel-title">Prestamo de recursos de Biblioteca</h5>
			</div>
			<div class="panel-body">
				<div>
					<h4>Usuario: <strong><?php echo $nombreUsuario; ?></strong> </h4>
					<div class="form-inline">
						<div class="form-group">
							<label for="codBarrOrigen">Recurso: </label>
							<input id='codBarrOrigen' type="text" name="codBarrOrigen" class="form-control" autofocus="autofocus" user="<?php echo $usuario['id'] ?>" />
						</div>
					</div>
				</div>
				<hr />
				<div>
					<table id="recursosEncontrados" class="table table-striped table-condensed">
						<thead>
							<tr>
								<th>Recurso</th>
								<th>Estatus</th>
								<th>Tipo Recurso</th>
								<th>Coleccion</th>
								<th>Clasificacion</th>
								<th>Prestamo</th>
								<th>PrestamoPruebas</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div class="col-md-12">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h5 class="panel-title">Recursos Prestados A Usuario</h5>
			</div>
			<div class="panel-body">
				<div>
				
				</div>
				<hr />
				<div>
					<table class="table table condensed table-striped">
						<thead>
							<tr>
								<th>Recurso</th>
								<th>Estatus</th>
								<th>Tipo Recurso</th>
								<th>Coleccion</th>
								<th>Clasificacion</th>
								<th>Entrega</th>
							</tr>
						</thead>
						<tbody>
							<?php foreach ($recursos as $recurso) :
							     $urlEntrega = $this->url(array('module'=>$modulo,'controller'=>'prestamo','action'=>'devolucion','us'=>$usuario['id'],'rc'=>$recurso['recurso']['idRecurso']),null,true);
							?>
							<tr>
								<td><?php echo $recurso['recurso']['recurso']; ?></td>
								<td><?php echo $recurso['estatus']['estatusRecurso']; ?></td>
								<td><?php echo $recurso['material']['material']; ?></td>
								<td><?php echo $recurso['coleccion']['coleccion']; ?></td>
								<td><?php echo $recurso['clasificacion']['clasificacion']; ?></td>
								<td>
									<a class="btn btn-link" href="<?php echo $urlEntrega; ?>">
										Entregar Recurso
									</a>
								</td>
							</tr>
							<?php endforeach; ?>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$().ready(function(){
		var appname = "/colegio/biblioteca";
		var url = window.location.origin + appname;
		//var idUsuario
		
		$("#codBarrOrigen").keypress(function(evt){
			//console.log(evt.which);
			console.log('keypress');
			if(evt.which === 13){
				console.log('keypress + enter');
				var idUsuario = $(this).attr('user');
				var valor = $(this).val();
				var urlQRecursos = url+'/json/brecursos/cr/'+valor;
				//console.log(urlQRecursos);
				

				$.ajax({
					url: urlQRecursos,
					dataType: "json",
					success: function(data){
						console.dir(data);
						var tbody = $("#recursosEncontrados").find('tbody'); 
                		tbody.empty();
						$.each(data, function(i,item){
							var urlPrestamo = url+'/prestamo/prestamo/rc/'+item.recurso.idRecurso+'/us/'+idUsuario;
							var urlPrestamoTest = url+'/prestamo/prestamot/rc/'+item.recurso.idRecurso+'/us/'+idUsuario;
							var link = $("<a></a>")
                                .attr("class","btn btn-link")
                                .attr("href",urlPrestamo)
                                //.attr("target","_blank")
                                .text("Prestar Recurso");
                            
							var linkT = $("<a></a>")
                                .attr("class","btn btn-link")
                                .attr("href",urlPrestamoTest)
                                //.attr("target","_blank")
                                .text("Prestar Recurso");

							//$("#grado").append($("<option></option>").attr("value",data[i].idGradoEducativo).text(data[i].gradoEducativo));
							tbody.append($('<tr>').
	                           append($('<td>').append(item.recurso.recurso)).
	                           append($('<td>').append(item.estatus.estatusRecurso)).
	                           append($('<td>').append(item.material.material)).
	                           append($('<td>').append(item.coleccion.coleccion)).
	                           append($('<td>').append(item.clasificacion.clasificacion)).
	                           append($('<td>').append(link)).
	                           append($('<td>').append(linkT))
	                       );
						});
					}
				});				
			}
		});
	});
</script>


